name: structure-enforcement

on: [push, pull_request]

permissions:
  contents: read

jobs:
  enforce:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Enforce boundaries
        run: |
          if find . -type f \( -name "*.py" -o -name "*.js" -o -name "*.sh" \) -print -quit | grep -q .; then
            echo "Executable files detected. Forbidden."
            exit 1
          fi

          if [ -d implementations ]; then
            shopt -s nullglob
            for entry in implementations/*; do
              name="$(basename "$entry")"
              if [ "$name" = "README.md" ]; then
                continue
              fi
              if [ -d "$entry" ] && [ -f "$entry/.git" ]; then
                continue
              fi
              echo "implementations/ must remain empty (README.md placeholder or submodules only)."
              exit 1
            done
          fi
